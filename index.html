<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CCD Stats ‚Äî Mock tipo League of Graphs</title>

  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg:#0f1720;
      --panel:#172233;
      --panel2:#1c2a3e;
      --panel3:#122033;
      --stroke:#2b3a52;
      --text:#d7e0ee;
      --muted:#92a4c3;
      --good:#26d07c;
      --warn:#ffcc66;
      --bad:#ff5c6c;
      --accent:#3aa0ff;
      --accent2:#a855f7;
      --chip:#0f2a22;
      --shadow: 0 10px 25px rgba(0,0,0,.25);
      --radius:16px;
      --radius2:22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 30% -10%, rgba(58,160,255,.22), transparent 60%),
                  radial-gradient(1000px 500px at 85% 15%, rgba(168,85,247,.18), transparent 55%),
                  var(--bg);
      color:var(--text);
    }

    a{color:inherit; text-decoration:none}
    .app{
      display:grid;
      grid-template-columns: 260px 1fr;
      min-height:100vh;
    }

    /* Sidebar */
    .sidebar{
      background: linear-gradient(180deg, rgba(23,34,51,.95), rgba(15,23,32,.95));
      border-right:1px solid var(--stroke);
      padding:18px 14px;
      position:sticky;
      top:0;
      height:100vh;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      padding:10px 10px 18px;
      border-bottom:1px solid var(--stroke);
      margin-bottom:14px;
    }
    .logo{
      width:38px;height:38px;border-radius:12px;
      background: linear-gradient(135deg, rgba(58,160,255,.9), rgba(168,85,247,.75));
      box-shadow: var(--shadow);
    }
    .brand h1{font-size:14px; margin:0; letter-spacing:.3px}
    .brand p{margin:2px 0 0; color:var(--muted); font-size:12px}

    .nav{
      margin-top:14px;
      display:flex; flex-direction:column; gap:6px;
    }
    .nav a{
      display:flex; align-items:center; gap:10px;
      padding:10px 10px;
      border-radius:12px;
      color:var(--muted);
      border:1px solid transparent;
    }
    .nav a.active{
      background: rgba(58,160,255,.10);
      border-color: rgba(58,160,255,.25);
      color:var(--text);
    }
    .nav a:hover{background: rgba(255,255,255,.03); color:var(--text)}
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(146,164,195,.6);
    }
    .active .dot{background: var(--accent)}
    .side-footer{
      position:absolute; left:14px; right:14px; bottom:14px;
      padding:12px; border:1px solid var(--stroke); border-radius:14px;
      background: rgba(18,32,51,.55);
      color:var(--muted); font-size:12px;
    }
    .pillrow{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .pill{
      font-size:11px;
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      color:var(--text);
      white-space:nowrap;
    }

    /* Main */
    .main{
      padding:18px 18px 28px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-bottom:14px;
    }
    .titleblock h2{margin:0; font-size:18px}
    .titleblock .sub{margin-top:4px; color:var(--muted); font-size:12px}

    .controls{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .search{
      width:280px; max-width:42vw;
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      background: rgba(23,34,51,.75);
      border:1px solid var(--stroke);
      border-radius:14px;
    }
    .search input{
      width:100%;
      background:transparent;
      border:none;
      outline:none;
      color:var(--text);
      font-size:13px;
    }
    .select, .btn{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background: rgba(23,34,51,.75);
      color:var(--text);
      font-size:13px;
      outline:none;
    }
    .btn{
      cursor:pointer;
      border-color: rgba(58,160,255,.35);
      background: rgba(58,160,255,.10);
    }
    .btn:hover{filter:brightness(1.08)}

    /* Tabs */
    .tabs{
      display:flex; gap:10px; flex-wrap:wrap;
      margin: 6px 0 14px;
      padding:10px;
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: rgba(18,32,51,.55);
    }
    .tab{
      padding:8px 10px;
      border-radius: 999px;
      color:var(--muted);
      border:1px solid transparent;
      cursor:pointer;
      user-select:none;
      font-size:13px;
    }
    .tab.active{
      color:var(--text);
      background: rgba(58,160,255,.10);
      border-color: rgba(58,160,255,.25);
    }

    /* KPI Cards */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }
    .card{
      background: rgba(23,34,51,.78);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .card .hd .k{font-size:12px; color:var(--muted)}
    .card .hd .badge{
      font-size:11px;
      padding:5px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      white-space:nowrap;
    }
    .card .bd{padding:14px}

    .kpi{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
    }
    .kpi .value{
      font-size:26px;
      font-weight:700;
      letter-spacing:.2px;
    }
    .kpi .delta{
      font-size:12px;
      color:var(--muted);
    }
    .delta .up{color:var(--good)}
    .delta .down{color:var(--bad)}
    .spark{
      height:36px; width:110px;
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(58,160,255,.18), rgba(58,160,255,0));
      border:1px solid rgba(58,160,255,.22);
    }

    /* Layout spans */
    .span-3{grid-column: span 3}
    .span-4{grid-column: span 4}
    .span-5{grid-column: span 5}
    .span-6{grid-column: span 6}
    .span-7{grid-column: span 7}
    .span-8{grid-column: span 8}
    .span-12{grid-column: span 12}

    /* Charts area */
    .charts{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
    }
    .chartwrap{
      height:320px;
    }
    .chartwrap.small{height:320px}
    canvas{width:100% !important; height:100% !important}

    /* Tags */
    .tagbox{
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .tag{
      font-size:12px;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(38,208,124,.10);
      color: #b9ffe0;
    }
    .tag.warn{background: rgba(255,204,102,.12); color:#ffe2b3}
    .tag.bad{background: rgba(255,92,108,.10); color:#ffc0c7}
    .tag.neutral{background: rgba(255,255,255,.03); color:var(--text)}

    /* Table */
    table{
      width:100%;
      border-collapse:collapse;
      overflow:hidden;
      border-radius: var(--radius);
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      font-size:13px;
      text-align:left;
    }
    th{color:var(--muted); font-weight:600}
    tr:hover td{background: rgba(255,255,255,.02)}
    .status{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      font-size:12px;
    }
    .status .s{width:8px;height:8px;border-radius:999px;background:var(--muted)}
    .status.good .s{background:var(--good)}
    .status.warn .s{background:var(--warn)}
    .status.bad .s{background:var(--bad)}

    /* Responsive */
    @media (max-width: 1020px){
      .app{grid-template-columns: 1fr}
      .sidebar{position:relative; height:auto}
      .charts{grid-template-columns: 1fr}
      .search{width:100%; max-width:none}
    }
    @media (max-width: 820px){
      .span-3,.span-4,.span-5,.span-6,.span-7,.span-8{grid-column: span 12}
    }
  </style>
</head>

<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>CCD ‚Äî Control Center Stats</h1>
          <p>Mock UI tipo League of Graphs</p>
        </div>
      </div>

      <nav class="nav" id="nav">
        <a href="#" class="active" data-view="home"><span class="dot"></span> Home</a>
        <a href="#" data-view="centros"><span class="dot"></span> Centros</a>
        <a href="#" data-view="brigadas"><span class="dot"></span> Brigadas</a>
        <a href="#" data-view="calidad"><span class="dot"></span> Calidad</a>
        <a href="#" data-view="reclamos"><span class="dot"></span> Reclamos</a>
        <a href="#" data-view="reportes"><span class="dot"></span> Reportes</a>
      </nav>

      <div class="side-footer">
        <div><strong>Patch Operacional</strong> (ejemplo)</div>
        <div style="margin-top:6px">Datos simulados ‚Ä¢ listo para enchufar a CSV/PowerBI export.</div>
        <div class="pillrow">
          <span class="pill">SEC / Regulatorios</span>
          <span class="pill">GNAT / Centrality</span>
          <span class="pill">Power BI</span>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div class="titleblock">
          <h2>Dashboard Operacional (CCD)</h2>
          <div class="sub" id="subtitle">Vista diaria ‚Ä¢ √öltima actualizaci√≥n: <span id="ts"></span></div>
        </div>

        <div class="controls">
          <div class="search">
            <span aria-hidden="true">üîé</span>
            <input id="q" placeholder="Buscar: brigada, comuna, ticket, evento‚Ä¶" />
          </div>

          <select class="select" id="centro">
            <option value="CCD Sur">CCD Sur</option>
            <option value="CCD Norte">CCD Norte</option>
            <option value="CCD PM">CCD Puerto Montt</option>
            <option value="CCD Val">CCD Valdivia</option>
          </select>

          <select class="select" id="empresa">
            <option value="SAESA">SAESA</option>
            <option value="FRONTEL">FRONTEL</option>
            <option value="EDELAYSEN">EDELAYSEN</option>
          </select>

          <select class="select" id="periodo">
            <option value="hoy">Hoy</option>
            <option value="7d">√öltimos 7 d√≠as</option>
            <option value="30d">√öltimos 30 d√≠as</option>
          </select>

          <button class="btn" id="refresh">‚Üª Actualizar</button>
        </div>
      </div>

      <div class="tabs" id="tabs">
        <div class="tab active" data-tab="operacion">Operaci√≥n</div>
        <div class="tab" data-tab="rutas">Rutas</div>
        <div class="tab" data-tab="recursos">Recursos</div>
        <div class="tab" data-tab="clientes">Clientes</div>
        <div class="tab" data-tab="calidad">Calidad</div>
      </div>

      <!-- KPI GRID -->
      <section class="grid" id="kpis">
        <div class="card span-3">
          <div class="hd">
            <div class="k">Bandeja total</div>
            <div class="badge">Tickets</div>
          </div>
          <div class="bd kpi">
            <div>
              <div class="value" id="kpi_backlog">2.270</div>
              <div class="delta">vs ayer: <span class="down" id="kpi_backlog_delta">-3.1%</span></div>
            </div>
            <div class="spark" aria-hidden="true"></div>
          </div>
        </div>

        <div class="card span-3">
          <div class="hd">
            <div class="k">Regulatorios &lt; 10 d√≠as</div>
            <div class="badge">SEC</div>
          </div>
          <div class="bd kpi">
            <div>
              <div class="value" id="kpi_reg10">184</div>
              <div class="delta">riesgo: <span class="warn" id="kpi_reg10_risk" style="color:var(--warn)">medio</span></div>
            </div>
            <div class="spark" style="background:linear-gradient(180deg, rgba(255,204,102,.18), rgba(255,204,102,0)); border-color: rgba(255,204,102,.22)" aria-hidden="true"></div>
          </div>
        </div>

        <div class="card span-3">
          <div class="hd">
            <div class="k">Cumplimiento concurrencia</div>
            <div class="badge">SLA llegada</div>
          </div>
          <div class="bd kpi">
            <div>
              <div class="value" id="kpi_conc">92.6%</div>
              <div class="delta">meta: 90% ‚Ä¢ <span class="up" id="kpi_conc_delta">+1.2%</span></div>
            </div>
            <div class="spark" style="background:linear-gradient(180deg, rgba(38,208,124,.18), rgba(38,208,124,0)); border-color: rgba(38,208,124,.22)" aria-hidden="true"></div>
          </div>
        </div>

        <div class="card span-3">
          <div class="hd">
            <div class="k">TME promedio</div>
            <div class="badge">Resoluci√≥n</div>
          </div>
          <div class="bd kpi">
            <div>
              <div class="value" id="kpi_tme">5h 18m</div>
              <div class="delta">vs 7d: <span class="up" id="kpi_tme_delta">-8%</span></div>
            </div>
            <div class="spark" aria-hidden="true"></div>
          </div>
        </div>

        <div class="card span-4">
          <div class="hd">
            <div class="k">Sem√°foro operacional</div>
            <div class="badge">Tags</div>
          </div>
          <div class="bd">
            <div class="tagbox" id="tags">
              <span class="tag">Buen uso de rutas</span>
              <span class="tag">Alta productividad</span>
              <span class="tag warn">Foco en regulatorios</span>
              <span class="tag neutral">Revisi√≥n autocierres</span>
              <span class="tag bad">Falsos positivos MI</span>
            </div>
          </div>
        </div>

        <div class="card span-8">
          <div class="hd">
            <div class="k">Resumen de brigadas (hoy)</div>
            <div class="badge">Live</div>
          </div>
          <div class="bd">
            <div class="grid" style="gap:10px">
              <div class="card span-3" style="box-shadow:none; background:rgba(18,32,51,.45)">
                <div class="bd">
                  <div style="color:var(--muted); font-size:12px">Activas</div>
                  <div style="font-size:22px; font-weight:700" id="mini_act">34</div>
                </div>
              </div>
              <div class="card span-3" style="box-shadow:none; background:rgba(18,32,51,.45)">
                <div class="bd">
                  <div style="color:var(--muted); font-size:12px">Cierre / d√≠a</div>
                  <div style="font-size:22px; font-weight:700" id="mini_cierre">268</div>
                </div>
              </div>
              <div class="card span-3" style="box-shadow:none; background:rgba(18,32,51,.45)">
                <div class="bd">
                  <div style="color:var(--muted); font-size:12px">KM recorridos</div>
                  <div style="font-size:22px; font-weight:700" id="mini_km">1.420</div>
                </div>
              </div>
              <div class="card span-3" style="box-shadow:none; background:rgba(18,32,51,.45)">
                <div class="bd">
                  <div style="color:var(--muted); font-size:12px">Clientes afectados</div>
                  <div style="font-size:22px; font-weight:700" id="mini_cli">7.850</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- CHARTS -->
      <section class="charts" id="charts">
        <div class="card">
          <div class="hd">
            <div class="k" id="chartTitle1">Evoluci√≥n bandeja y cierres</div>
            <div class="badge">Tendencia</div>
          </div>
          <div class="bd chartwrap">
            <canvas id="chartBacklog"></canvas>
          </div>
        </div>

        <div class="card">
          <div class="hd">
            <div class="k" id="chartTitle2">Productividad por brigada</div>
            <div class="badge">Comparativo</div>
          </div>
          <div class="bd chartwrap small">
            <canvas id="chartBrigadas"></canvas>
          </div>
        </div>
      </section>

      <!-- TABLE -->
      <section style="margin-top:12px" id="tableWrap">
        <div class="card">
          <div class="hd">
            <div class="k">Brigadas destacadas (mock)</div>
            <div class="badge">Ranking</div>
          </div>
          <div class="bd" style="overflow:auto">
            <table>
              <thead>
                <tr>
                  <th>Brigada</th>
                  <th>Zona</th>
                  <th>Cerrados</th>
                  <th>Regulatorios</th>
                  <th>Concurrencia</th>
                  <th>TME</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody id="brigTable"></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ---------- Helpers ----------
    const fmt = (n) => n.toLocaleString("es-CL");
    const now = new Date();
    document.getElementById("ts").textContent = now.toLocaleString("es-CL");

    // Demo dataset generator
    function genSeries(days=21, start=2300){
      const x = [];
      let v = start;
      for(let i=0;i<days;i++){
        v += Math.round((Math.random()-0.55)*70); // gently trending down
        v = Math.max(0, v);
        x.push(v);
      }
      return x;
    }

    function genCloses(days=21, base=220){
      const x = [];
      for(let i=0;i<days;i++){
        x.push(Math.max(0, Math.round(base + (Math.random()-0.3)*60)));
      }
      return x;
    }

    // ---------- Charts ----------
    let chartBacklog, chartBrigadas;

    function buildCharts(){
      const labels = Array.from({length:21}, (_,i)=> i); // "minutos" style LoG, aqu√≠ lo usamos como "d√≠as"
      const backlog = genSeries(21, 2400);
      const closes = genCloses(21, 240);

      const ctx1 = document.getElementById("chartBacklog");
      chartBacklog = new Chart(ctx1, {
        type: "line",
        data: {
          labels,
          datasets: [
            { label: "Bandeja (tickets)", data: backlog, tension: .35, fill: true, borderWidth: 2 },
            { label: "Cierres/d√≠a", data: closes, tension: .35, fill: false, borderWidth: 2 }
          ]
        },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins: {
            legend: { labels: { color: "#d7e0ee" } },
            tooltip: { mode: "index", intersect:false }
          },
          scales: {
            x: { ticks:{ color:"#92a4c3" }, grid:{ color:"rgba(255,255,255,.06)" } },
            y: { ticks:{ color:"#92a4c3" }, grid:{ color:"rgba(255,255,255,.06)" } }
          }
        }
      });

      const brigNames = ["B-12", "B-07", "B-21", "B-03", "B-15", "B-09"];
      const prod = brigNames.map(()=> Math.round(18 + Math.random()*22));
      const ctx2 = document.getElementById("chartBrigadas");
      chartBrigadas = new Chart(ctx2, {
        type: "bar",
        data: {
          labels: brigNames,
          datasets: [
            { label: "Cierres (hoy)", data: prod, borderWidth: 1 }
          ]
        },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins: { legend: { labels: { color:"#d7e0ee" } } },
          scales: {
            x: { ticks:{ color:"#92a4c3" }, grid:{ display:false } },
            y: { ticks:{ color:"#92a4c3" }, grid:{ color:"rgba(255,255,255,.06)" } }
          }
        }
      });

      // Quick KPI sync
      const last = backlog[backlog.length-1];
      const prev = backlog[backlog.length-2] ?? last;
      const delta = prev ? ((last - prev) / prev) * 100 : 0;

      document.getElementById("kpi_backlog").textContent = fmt(last);
      document.getElementById("kpi_backlog_delta").textContent =
        (delta <= 0 ? "" : "+") + delta.toFixed(1) + "%";

      // Mock other KPIs (pon aqu√≠ tus medidas reales cuando lo conectes a datos)
      const conc = (90 + Math.random()*6).toFixed(1);
      document.getElementById("kpi_conc").textContent = conc + "%";
      document.getElementById("kpi_conc_delta").textContent = (Math.random()>0.5?"+":"") + (Math.random()*2).toFixed(1) + "%";

      const reg10 = Math.round(120 + Math.random()*140);
      document.getElementById("kpi_reg10").textContent = fmt(reg10);
      document.getElementById("kpi_reg10_risk").textContent = reg10 > 220 ? "alto" : (reg10 > 160 ? "medio" : "bajo");
      document.getElementById("kpi_reg10_risk").style.color = reg10 > 220 ? "var(--bad)" : (reg10 > 160 ? "var(--warn)" : "var(--good)");

      const tmeMin = Math.round(260 + Math.random()*180); // 4h20 a 7h20
      const h = Math.floor(tmeMin/60), m = tmeMin%60;
      document.getElementById("kpi_tme").textContent = `${h}h ${String(m).padStart(2,"0")}m`;
      document.getElementById("kpi_tme_delta").textContent = (Math.random()>0.5? "-" : "+") + (Math.random()*10).toFixed(0) + "%";

      document.getElementById("mini_act").textContent = fmt(Math.round(26 + Math.random()*18));
      document.getElementById("mini_cierre").textContent = fmt(Math.round(210 + Math.random()*140));
      document.getElementById("mini_km").textContent = fmt(Math.round(900 + Math.random()*900));
      document.getElementById("mini_cli").textContent = fmt(Math.round(2500 + Math.random()*12000));
    }

    function destroyCharts(){
      if(chartBacklog) chartBacklog.destroy();
      if(chartBrigadas) chartBrigadas.destroy();
    }

    // ---------- Table ----------
    function renderTable(){
      const rows = [
        { b:"B-12", z:"Osorno", c:44, r:9,  conc:"96%", tme:"4h 40m", st:"good", label:"√ìptimo" },
        { b:"B-07", z:"Puerto Montt", c:38, r:14, conc:"92%", tme:"5h 10m", st:"good", label:"Estable" },
        { b:"B-21", z:"Valdivia", c:31, r:18, conc:"88%", tme:"6h 05m", st:"warn", label:"En riesgo" },
        { b:"B-03", z:"Chilo√©", c:26, r:22, conc:"85%", tme:"6h 50m", st:"bad",  label:"Cr√≠tico" },
        { b:"B-15", z:"La Uni√≥n", c:29, r:8,  conc:"94%", tme:"5h 00m", st:"good", label:"Bueno" },
      ];
      const tb = document.getElementById("brigTable");
      tb.innerHTML = rows.map(x => `
        <tr>
          <td><strong>${x.b}</strong></td>
          <td>${x.z}</td>
          <td>${x.c}</td>
          <td>${x.r}</td>
          <td>${x.conc}</td>
          <td>${x.tme}</td>
          <td><span class="status ${x.st}"><span class="s"></span>${x.label}</span></td>
        </tr>
      `).join("");
    }

    // ---------- Tabs ----------
    function setTab(tab){
      document.querySelectorAll(".tab").forEach(t => t.classList.toggle("active", t.dataset.tab === tab));

      // Cambiamos t√≠tulos para simular "secciones" tipo LoG
      const t1 = document.getElementById("chartTitle1");
      const t2 = document.getElementById("chartTitle2");
      if(tab==="operacion"){
        t1.textContent = "Evoluci√≥n bandeja y cierres";
        t2.textContent = "Productividad por brigada";
      } else if(tab==="rutas"){
        t1.textContent = "KM recorridos vs cierres";
        t2.textContent = "Cierres por comuna (top)";
      } else if(tab==="recursos"){
        t1.textContent = "Ocupaci√≥n brigada (minutos) ‚Äî tendencia";
        t2.textContent = "Horas-hombre estimadas (top brigadas)";
      } else if(tab==="clientes"){
        t1.textContent = "Clientes afectados vs normalizaciones";
        t2.textContent = "Reclamos por incidencia (top)";
      } else if(tab==="calidad"){
        t1.textContent = "Falsas alarmas / autocierres ‚Äî tendencia";
        t2.textContent = "Reincidencias por frente (top)";
      }

      // Para el mock, regeneramos (en real: solo cambias datasets)
      destroyCharts();
      buildCharts();
    }

    // ---------- Events ----------
    document.getElementById("refresh").addEventListener("click", () => {
      destroyCharts();
      buildCharts();
      renderTable();
      document.getElementById("ts").textContent = new Date().toLocaleString("es-CL");
    });

    document.getElementById("tabs").addEventListener("click", (e) => {
      const el = e.target.closest(".tab");
      if(!el) return;
      setTab(el.dataset.tab);
    });

    // Sidebar nav "active"
    document.getElementById("nav").addEventListener("click", (e) => {
      const a = e.target.closest("a");
      if(!a) return;
      e.preventDefault();
      document.querySelectorAll(".nav a").forEach(x=>x.classList.remove("active"));
      a.classList.add("active");
    });

    // Mock search (solo demo)
    document.getElementById("q").addEventListener("input", (e) => {
      const q = e.target.value.trim().toLowerCase();
      const rows = document.querySelectorAll("#brigTable tr");
      rows.forEach(r => {
        const txt = r.textContent.toLowerCase();
        r.style.display = txt.includes(q) ? "" : "none";
      });
    });

    // Filter change -> refresh demo
    ["centro","empresa","periodo"].forEach(id => {
      document.getElementById(id).addEventListener("change", () => {
        destroyCharts(); buildCharts(); renderTable();
      });
    });

    // ---------- Init ----------
    renderTable();
    buildCharts();
  </script>
</body>
</html>
